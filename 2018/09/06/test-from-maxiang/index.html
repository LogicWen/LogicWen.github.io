<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>test_from_maxiang | 文康宇的blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">test_from_maxiang</h1><a id="logo" href="/.">文康宇的blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Accueil</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> À propos</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">test_from_maxiang</h1><div class="post-meta">Sep 6, 2018</div><div class="post-content"><p>#Java垃圾回收<br>[TOC]</p>
<p>##Java对象的内存布局<br>mark word（对象头） –&gt; class point（类指针，指向类的数据） –&gt; instance data（对象的数据） –&gt;padding（对齐填充，<strong>8个字节</strong>对齐的）<br>32位系统中refrence是四个字节，64位中的是八个字节</p>
<p>Java是通<strong>引用</strong>来访问对象的。</p>
<p>某个方法，先找到这个对象，再找这个对象的类，再找父类。<br><a id="more"></a></p>
<p>##Java早期的GC方法</p>
<p>###引用计数法<br><strong>缺点：</strong>相互引用 循环引用不行</p>
<p>##Java根节点可达性分析<br>一开始是这个方法<br>从GC Roots找。</p>
<p><strong>那些对象可以作为根节点？</strong></p>
<ul>
<li>虚拟机栈中引用对象（局部变量表）</li>
<li>方法区中静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>本地方法栈中JNI引用的对象   </li>
</ul>
<p>##如何进行垃圾回收</p>
<p>###标记-清除 算法（Mark-Sweep）<br>第一阶段进行标记，第二阶段进行清除，产生了内存碎片</p>
<p>###复制算法（Copying）[新生代的方法]<br>按照容量分成两块，把能够活下来的copy，把之前的清零。这个和存活的多少有关。（前提是活的对象少，死的对象多）</p>
<p>###标记-整理算法（Mark-Compact）[老年代的方法]<br>移动对象到一端，然后清理掉端边界以外的对象</p>
<p>###分代算法（因为每次浪费一半的内存，改进了）<br>Eden和Survivor1 Survivor2（8:1:1）<br>新生代是minorGC<br>当Survivor2空间不够，则以来其他内存（放入老年代）</p>
<p>当Eden满了之后，清算eden和survivor两个区域里面的对象</p>
<p>当<strong>年老代满了，</strong>将会进行一次full GC。</p>
<p><strong>存入年老代的对象：</strong>1.放不下了 2.经过了很多次minor GC</p>
<p><strong>永久代：</strong>方法区。（permnate generate）</p>
<p><strong>永久代的回收：</strong></p>
<blockquote>
<p>废弃无用的常量（常量池中的“abc”已经没有被任何字符串引用）<br>无用的类（所有实例都被回收 or   加载该类的classloader被回收 or  Class对象没有任何地方被引用，无法在任何地方通过反射访问该类的方法 ）<br><strong>垃圾回收的性价比比较低</strong></p>
</blockquote>
<p>###对象分配和垃圾回收<br><strong>对象优先在新生代Eden分配，</strong>新生代minorGC的速度快，而且频繁，性价比高<br><strong>大对象直接进入老年代：</strong>通过-XX:PretenureSizeThreshold控制<br><strong>长期存活对象进入老年代：</strong>age &gt; MaxTenuringThreshold（minorGC一次，年龄加1，默认是<strong>15</strong>）<br><strong>动态年龄判断：</strong> 当某个年龄的对象个数大于该survivor空间的一半，大于等于该年龄对象直接进入老年代</p>
<p>GC的时候会<strong>Stop the world!</strong></p>
<p><strong>HandlerPromotionFailure</strong>对象分配担保。</p>
<p>##垃圾回收的实现</p>
<blockquote>
<p><strong>Serial/Serial Old</strong>（串行）   stop the world GC线程是单线程的<br><strong>Parnew</strong>（并行）也需要暂停用户线程，只是多个线程进行垃圾回收， 添加了一个safepoint<br><strong>Parallel Scavenge/Parallel Old</strong>（吞吐量优先的）<br><strong>CMS</strong>（最短回收）[初始标记 并发标记 重新标记 并发清理 重置线程]<br><strong>G1</strong>（面向服务端应用的来讲收集器，采用<strong>标记-整理算法</strong>）[G1收集器可以独立管理两个代的GC]</p>
</blockquote>
<p><strong>JVM的两种运行模式：</strong>client 和 server 模式</p>
</div><div class="tags"></div><div class="post-nav"><a class="next" href="/2018/09/06/hello-world/">Hello World</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Catégories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/默认分类/">默认分类</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/tag1/" style="font-size: 15px;">tag1</a> <a href="/tags/tag2/" style="font-size: 15px;">tag2</a> <a href="/tags/tag3/" style="font-size: 15px;">tag3</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Récent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/test-from-maxiang/">test_from_maxiang</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/12/02/测试blog/">postName</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> À suivre</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">文康宇的blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>